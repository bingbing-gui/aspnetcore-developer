å½“ä½ æ‹¥æœ‰å¤šä¸ªæ’ä»¶æ—¶ï¼Œæ¥ä¸‹æ¥å°±éœ€è¦ä¸€ç§æ–¹å¼è®©ä½ çš„ AI ä»£ç†ç»„åˆä½¿ç”¨è¿™äº›æ’ä»¶ï¼Œæ¥å®Œæˆç”¨æˆ·çš„è¯·æ±‚â€”â€”è¿™å°±æ˜¯**è§„åˆ’ï¼ˆPlanningï¼‰**çš„ç”¨é€”ã€‚

## 1. Planningçš„æ¼”è¿›

åœ¨ Semantic Kernel çš„æ—©æœŸé˜¶æ®µï¼Œæ›¾å¼•å…¥â€œPlannerâ€çš„æ¦‚å¿µï¼Œä½¿ç”¨æç¤ºè¯ï¼ˆPromptï¼‰å¼•å¯¼ AI å†³å®šè¦è°ƒç”¨å“ªäº›å‡½æ•°ã€‚ä½†è‡ªé‚£ä¹‹åï¼ŒOpenAI å¼•å…¥äº†**åŸç”Ÿå‡½æ•°è°ƒç”¨ï¼ˆFunction Callingï¼‰**åŠŸèƒ½ï¼›å…¶ä»– AI æ¨¡å‹å¦‚ Geminiã€Claudeã€Mistral ä¹Ÿå°†å…¶ä½œä¸ºæ ¸å¿ƒåŠŸèƒ½æ”¯æŒï¼Œè¿™ä½¿å¾—å‡½æ•°è°ƒç”¨æˆä¸ºä¸€ä¸ªè·¨æ¨¡å‹é€šç”¨ç‰¹æ€§ã€‚

å› æ­¤ï¼ŒSemantic Kernel ä¹Ÿéšä¹‹æ¼”è¿›ï¼Œå°†å‡½æ•°è°ƒç”¨ä½œä¸ºä¸»è¦çš„ä»»åŠ¡è§„åˆ’ä¸æ‰§è¡Œæ–¹å¼ã€‚

> **é‡è¦æç¤º**  
> å‡½æ•°è°ƒç”¨ä»…é€‚ç”¨äº OpenAI æ¨¡å‹ 0613 æˆ–æ›´æ–°ç‰ˆæœ¬ã€‚å¦‚æœä½ ä½¿ç”¨çš„æ˜¯æ—§ç‰ˆæœ¬æ¨¡å‹ï¼ˆå¦‚ 0314ï¼‰ï¼Œæ­¤åŠŸèƒ½å°†æ— æ³•ä½¿ç”¨å¹¶è¿”å›é”™è¯¯ã€‚æˆ‘ä»¬å»ºè®®ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬çš„ OpenAI æ¨¡å‹ä»¥å……åˆ†åˆ©ç”¨æ­¤ç‰¹æ€§ã€‚

---

## 2. å‡½æ•°è°ƒç”¨æ˜¯å¦‚ä½•åˆ›å»ºPlanningçš„ï¼Ÿ

ä»æœ¬è´¨ä¸Šè®²ï¼Œå‡½æ•°è°ƒç”¨åªæ˜¯ AI ä»¥æ­£ç¡®å‚æ•°è°ƒç”¨å‡½æ•°çš„ä¸€ç§æ–¹å¼ã€‚ä¾‹å¦‚ï¼Œç”¨æˆ·å¸Œæœ›æ‰“å¼€ä¸€ä¸ªç¯æ³¡ï¼š

| è§’è‰² | æ¶ˆæ¯å†…å®¹ |
| ---- | -------- |
| ğŸ”µ User | è¯·æ‰“å¼€ 1 å·ç¯ |
| ğŸ”´ Assistant (function call)	| `Lights.change_state(1, { "isOn": true })` |
| ğŸŸ¢ Tool | `{ "id": 1, "name": "å°ç¯", "isOn": true, "brightness": 100, "hex": "FF0000" }` |
| ğŸ”´ Assistant | ç¯å·²æ‰“å¼€ |

ä½†å¦‚æœç”¨æˆ·ä¸çŸ¥é“ç¯çš„ ID å‘¢ï¼Ÿæˆ–è€…ç”¨æˆ·å¸Œæœ›åŒæ—¶æ‰“å¼€æ‰€æœ‰ç¯ï¼Ÿè¿™æ—¶å°±éœ€è¦**â€œè§„åˆ’â€èƒ½åŠ›**ã€‚

ç°ä»£ LLM æ¨¡å‹å…·å¤‡é€æ­¥è°ƒç”¨å‡½æ•°å¹¶åŸºäºç»“æœåšå‡ºå†³ç­–çš„èƒ½åŠ›ã€‚AI å¯ä»¥å…ˆè°ƒç”¨å‡½æ•°è·å–çŠ¶æ€ï¼Œå†å†³å®šæ‰§è¡Œå“ªä¸ªåŠ¨ä½œã€‚

### ä¾‹å­ï¼šç”¨æˆ·æƒ³â€œåˆ‡æ¢æ‰€æœ‰ç¯çš„çŠ¶æ€â€

| è§’è‰² | æ¶ˆæ¯å†…å®¹ |
| ---- | -------- |
| ğŸ”µ User | è¯·åˆ‡æ¢æ‰€æœ‰ç¯çš„çŠ¶æ€ |
| ğŸ”´ Assistant (function call)| `Lights.get_lights()` |
| ğŸŸ¢ Tool | `{ lights: [{ id: 1, isOn: true }, { id: 2, isOn: false }] }` |
| ğŸ”´ Assistant (function call) | `Lights.change_state(1, { "isOn": false })`<br/>`Lights.change_state(2, { "isOn": true })` |
| ğŸŸ¢ Tool | ç¯çŠ¶æ€æ›´æ–°æˆåŠŸ |
| ğŸ”´ Assistant | æ‰€æœ‰ç¯çš„çŠ¶æ€å·²åˆ‡æ¢ |

> ğŸ’¡ **è¯´æ˜ï¼šå¹¶è¡Œè°ƒç”¨**  
> ä¸Šè¿°ä¾‹å­å±•ç¤ºäº†**å¹¶è¡Œå‡½æ•°è°ƒç”¨**â€”â€”AI å¯åŒæ—¶å‘å‡ºå¤šä¸ªå‡½æ•°è°ƒç”¨è¯·æ±‚ã€‚æ­¤åŠŸèƒ½ä» OpenAI æ¨¡å‹ 1106 ç‰ˆæœ¬å¼€å§‹æ”¯æŒï¼Œå¤§å¤§åŠ å¿«äº†å¤„ç†å¤æ‚ä»»åŠ¡çš„æ•ˆç‡ã€‚

---

## 3. è‡ªåŠ¨è§„åˆ’å¾ªç¯ï¼ˆFunction Calling Loopï¼‰

å¦‚æœä¸ä½¿ç”¨ Semantic Kernelï¼Œæƒ³è¦æ”¯æŒå‡½æ•°è°ƒç”¨è§„åˆ’ï¼Œä½ éœ€è¦è‡ªå·±å®ç°ä¸€ä¸ªâ€œè°ƒç”¨å¾ªç¯â€ï¼š

1. ä¸ºæ¯ä¸ªå‡½æ•°åˆ›å»º JSON schema
2. æä¾›ç»™ LLM å½“å‰çš„èŠå¤©å†å²å’Œå‡½æ•° schema
3. è§£æ LLM è¿”å›å†…å®¹ï¼Œåˆ¤æ–­æ˜¯å›å¤æ¶ˆæ¯è¿˜æ˜¯è°ƒç”¨å‡½æ•°
4. å¦‚æœæ˜¯å‡½æ•°è°ƒç”¨ï¼Œæå–å‡½æ•°åå’Œå‚æ•°
5. æ‰§è¡Œå¯¹åº”å‡½æ•°
6. å°†ç»“æœè¿”å›ç»™ LLM
7. é‡å¤ç¬¬ 2ï½6 æ­¥ï¼Œç›´åˆ°ä»»åŠ¡å®Œæˆæˆ–éœ€è¦ç”¨æˆ·è¾“å…¥

âœ… **Semantic Kernel å¸®ä½ è‡ªåŠ¨å®Œæˆè¿™ä¸ªå¾ªç¯**  
ä½ åªéœ€ä¸“æ³¨äºæ„å»ºæ’ä»¶æ¥æ»¡è¶³ç”¨æˆ·éœ€æ±‚ï¼Œå…¶ä½™æ­¥éª¤ç”± Semantic Kernel è‡ªåŠ¨å¤„ç†ã€‚

> â„¹ï¸ æƒ³æ·±å…¥äº†è§£å‡½æ•°è°ƒç”¨å¾ªç¯çš„æ‰§è¡Œæœºåˆ¶ï¼Œè¯·å‚è€ƒ Function Calling å·¥ä½œåŸç† æ–‡æ¡£ã€‚

---

## 4. å¦‚ä½•åœ¨ Semantic Kernel ä¸­å¯ç”¨å‡½æ•°è°ƒç”¨

ä½ éœ€è¦å®Œæˆä»¥ä¸‹ 3 æ­¥ï¼š

### 1. æ³¨å†Œæ’ä»¶

```csharp
var builder = Kernel.CreateBuilder()
    .AddAzureOpenAIChatCompletion(modelId, endpoint, apiKey);

builder.Plugins.AddFromType<LightsPlugin>("Lights");
var kernel = builder.Build();
```

### 2. å¯ç”¨è‡ªåŠ¨å‡½æ•°è°ƒç”¨

```csharp
var settings = new OpenAIPromptExecutionSettings
{
    FunctionChoiceBehavior = FunctionChoiceBehavior.Auto()
};
```

### 3. ä½¿ç”¨ ChatCompletion å¯åŠ¨äº¤äº’

```csharp
var chatService = kernel.GetRequiredService<IChatCompletionService>();
var history = new ChatHistory();

string? userInput;
do {
    Console.Write("User > ");
    userInput = Console.ReadLine();
    history.AddUserMessage(userInput);

    var result = await chatService.GetChatMessageContentAsync(
        history,
        executionSettings: settings,
        kernel: kernel);

    Console.WriteLine("Assistant > " + result);
    history.AddMessage(result.Role, result.Content ?? string.Empty);
} while (userInput is not null);
```

âœ… æ‰€æœ‰å‡½æ•°è°ƒç”¨è¿‡ç¨‹å’Œç»“æœéƒ½ä¼šè‡ªåŠ¨å†™å…¥ ChatHistoryï¼Œä½ å¯ä»¥éšæ—¶æŸ¥çœ‹ AI è°ƒç”¨äº†å“ªäº›å‡½æ•°ä»¥åŠå®ƒæ˜¯å¦‚ä½•å¾—å‡ºæœ€ç»ˆç»“è®ºçš„ã€‚

---

## 5. ä»€ä¹ˆæƒ…å†µåºŸå¼ƒäº†æ—§çš„è§„åˆ’å™¨ï¼Ÿ

Stepwise Planner å’Œ Handlebars Planner è¿™ä¸¤ä¸ªæ—§æœ‰çš„è§„åˆ’å™¨å·²ç»è¢«å¼ƒç”¨å¹¶ç§»é™¤ï¼Œä¸å†æ”¯æŒ .NET / Python / Javaã€‚

è¯·æ”¹ç”¨**å‡½æ•°è°ƒç”¨ï¼ˆFunction Callingï¼‰**ï¼Œå®ƒæä¾›äº†æ›´å¼ºå¤§ã€å¯æ§ã€ä¸”ç®€æ´çš„å¼€å‘ä½“éªŒã€‚

> ğŸ” å¦‚éœ€å°†æ—§æ–¹æ¡ˆè¿ç§»åˆ°å‡½æ•°è°ƒç”¨ï¼Œè¯·å‚è€ƒå®˜æ–¹çš„ Stepwise Planner è¿ç§»æŒ‡å—ã€‚

---

## 6. ç»“è¯­

| é¡¹ç›® | æ¨èåšæ³• |
| ---- | -------- |
| æ–°é¡¹ç›®Planning | ä½¿ç”¨å‡½æ•°è°ƒç”¨ Function Calling |
| æ—§ä»£ç è¿ç§» | æ”¾å¼ƒ Stepwise / Handlebars Planner |
| å¤šæ’ä»¶åè°ƒæ‰§è¡Œ | åˆ©ç”¨å‡½æ•°è°ƒç”¨å®ç°è‡ªåŠ¨è§„åˆ’å’Œæ‰§è¡Œ |
| å¤šæ¨¡å‹æ”¯æŒ | å…¼å®¹ OpenAIã€Geminiã€Claudeã€Mistral ç­‰ |

