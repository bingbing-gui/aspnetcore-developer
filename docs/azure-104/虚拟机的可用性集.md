# 为什么要使用可用性集

在云环境中，即使虚拟机运行正常，底层的物理服务器、网络设备或主机操作系统仍然可能发生故障或需要维护。
如果所有虚拟机都部署在同一套物理资源上，一旦出现问题，整个应用就可能同时不可用。

可用性集的作用，正是为了解决这一风险：

- 避免单点故障  
    Azure 会将同一可用性集中的虚拟机分布到不同的物理硬件上，单台服务器或机架出问题时，不会影响所有虚拟机。
- 保证业务连续性  
    当部分虚拟机发生故障或被升级时，其他虚拟机仍可正常运行，应用服务不会整体中断。
- 支持平台维护和升级  
    在 Azure 进行主机系统升级时，可用性集可以确保虚拟机分批更新，避免一次性全部下线。
- 满足高可用架构需求  
    可用性集是构建高可用架构的基础能力，通常会与多实例部署和负载均衡一起使用。
- 获得官方 SLA 保障  
    将虚拟机部署在可用性集中，是获得 Azure 虚拟机高可用 SLA 的前提条件之一。

---

## 可用性集（Availability Set）

可用性集是一种逻辑分组方式，用来把一组相关的虚拟机部署在一起，从而减少单点故障带来的影响。同时，它可以确保在数据中心进行主机操作系统升级时，不会同时升级所有虚拟机。

### 可用性集的主要特点

- 可用性集中的虚拟机通常承担相同的业务功能。
- 可用性集中的虚拟机应安装相同的软件和配置。
- Azure 会将这些虚拟机分散部署在不同的物理服务器、机架、存储设备和网络交换机上。
- 当发生硬件故障或 Azure 平台问题时，只会影响其中一部分虚拟机，整体应用仍然可以继续运行。
- 创建虚拟机时，可以同时创建并指定可用性集。
- 虚拟机只能在创建阶段加入可用性集，创建完成后无法更改；如需调整，只能删除并重新创建虚拟机。
- 可用性集可以通过 Azure 门户、ARM 模板、脚本或 API 方式创建。
- Azure 为使用可用性集的虚拟机提供明确的 SLA 服务保障。

> 注意：可用性集只能提升基础设施层面的可用性，无法避免操作系统或应用程序自身的故障。如需更全面的保护，还需要配合备份和灾难恢复方案。

---

## 使用可用性集时的建议

- 保证冗余：在同一个可用性集中部署多台虚拟机，避免单台虚拟机故障导致服务中断。
- 区分应用层级：不同的应用层（如前端、后端、数据库）应放在不同的可用性集中，降低整体风险。
- 搭配负载均衡：结合 Azure Load Balancer 使用，将访问流量分配到运行正常的虚拟机上。
- 使用托管磁盘：可用性集支持使用 Azure 托管磁盘，简化存储管理并提升可靠性。
