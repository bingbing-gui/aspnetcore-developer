# Semantic Kernel ä¸­å‘é‡å­˜å‚¨

å‘é‡æ•°æ®åº“åœ¨è‡ªç„¶è¯­è¨€å¤„ç†ï¼ˆNLPï¼‰ã€è®¡ç®—æœºè§†è§‰ï¼ˆCVï¼‰ã€æ¨èç³»ç»Ÿï¼ˆRSï¼‰ç­‰éœ€è¦è¯­ä¹‰ç†è§£ä¸åŒ¹é…çš„æ•°æ®åº”ç”¨åœºæ™¯ä¸­æœ‰å¹¿æ³›ç”¨é€”ã€‚

---

## ğŸ’¡ åº”ç”¨åœºæ™¯ï¼šè¾…åŠ©å¤§è¯­è¨€æ¨¡å‹ç”Ÿæˆæ›´ä¼˜å†…å®¹

å…¶ä¸­ä¸€ä¸ªä½¿ç”¨å‘é‡æ•°æ®åº“çš„å…¸å‹åœºæ™¯æ˜¯ï¼š**å¸®åŠ©å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMsï¼‰ç”Ÿæˆæ›´ç›¸å…³ã€æ›´è¿è´¯çš„å›ç­”**ã€‚

å¤§è¯­è¨€æ¨¡å‹å¸¸é¢ä¸´ä»¥ä¸‹é—®é¢˜ï¼š

- ç”Ÿæˆä¸å‡†ç¡®æˆ–æ— å…³çš„ä¿¡æ¯
- ç¼ºä¹äº‹å®ä¸€è‡´æ€§æˆ–å¸¸è¯†
- é‡å¤æˆ–è‡ªç›¸çŸ›ç›¾
- å‡ºç°åè§æˆ–å†’çŠ¯æ€§å†…å®¹

ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨å‘é‡æ•°æ®åº“å­˜å‚¨ä¸ä½ ç›®æ ‡é¢†åŸŸæˆ–å†…å®¹ç›¸å…³çš„ï¼š

- ä¸»é¢˜
- å…³é”®è¯
- äº‹å®
- è§‚ç‚¹
- ä¿¡æ¯æ¥æºç­‰

å‘é‡æ•°æ®åº“èƒ½é«˜æ•ˆæ£€ç´¢å‡ºä¸ç‰¹å®šé—®é¢˜ç›¸å…³çš„ä¿¡æ¯å­é›†ï¼Œå¹¶å°†å…¶ä¸æç¤ºè¯ï¼ˆpromptï¼‰ä¸€åŒä¼ é€’ç»™å¤§è¯­è¨€æ¨¡å‹ï¼Œç”Ÿæˆæ›´å‡†ç¡®ã€æ›´å…·ä¸Šä¸‹æ–‡çš„å›ç­”ã€‚

---

## âœï¸ ç¤ºä¾‹

> å¦‚æœä½ æƒ³å†™ä¸€ç¯‡å…³äºâ€œAI æœ€æ–°è¶‹åŠ¿â€çš„åšå®¢æ–‡ç« ï¼Œå¯ä»¥å…ˆå°†ä¸è¯¥ä¸»é¢˜ç›¸å…³çš„æœ€æ–°èµ„è®¯å­˜å…¥å‘é‡æ•°æ®åº“ã€‚  
> ç„¶åå°†è¿™äº›ä¿¡æ¯ä¸ç”Ÿæˆè¯·æ±‚ä¸€å¹¶å‘é€ç»™å¤§è¯­è¨€æ¨¡å‹ï¼Œå°±èƒ½ç”Ÿæˆå†…å®¹ä¸°å¯Œã€åŸºäºæœ€æ–°èµ„æ–™çš„æ–‡ç« ã€‚

---

## ğŸ§  Semantic Kernel ä¸ .NET çš„æ”¯æŒ

Semantic Kernel å’Œ .NET æä¾›äº†ä¸å‘é‡å­˜å‚¨äº¤äº’çš„æŠ½è±¡æ¥å£ï¼Œå¹¶å†…ç½®äº†ä¸€ç³»åˆ—é€‚é…å¤šç§æ•°æ®åº“çš„å®ç°ï¼ŒåŠŸèƒ½åŒ…æ‹¬ï¼š

- åˆ›å»ºã€åˆ—å‡ºã€åˆ é™¤å‘é‡é›†åˆï¼ˆCollectionsï¼‰
- ä¸Šä¼ ã€è¯»å–ã€åˆ é™¤å‘é‡è®°å½•ï¼ˆRecordsï¼‰

é€šè¿‡è¿™äº›æŠ½è±¡æ¥å£ï¼Œå¼€å‘è€…å¯ä»¥å…ˆä½¿ç”¨å…è´¹æˆ–æœ¬åœ°å‘é‡å­˜å‚¨è¿›è¡Œå¼€å‘æµ‹è¯•ï¼Œå†æ— ç¼åˆ‡æ¢è‡³äº‘ç«¯æœåŠ¡è¿›è¡Œæ‰©å±•ï¼Œæ— éœ€é‡æ„ä»£ç ã€‚

---

## ä½¿ç”¨å‘é‡å­˜å‚¨å®ç° RAGï¼ˆRetrieval Augmented Generationï¼‰

å‘é‡å­˜å‚¨æŠ½è±¡å±‚æ˜¯ä¸€ä¸ªåº•å±‚ APIï¼Œç”¨äºå‘å‘é‡æ•°æ®åº“ä¸­**æ·»åŠ å’Œæ£€ç´¢æ•°æ®**ã€‚Semantic Kernel åŸç”Ÿæ”¯æŒé€šè¿‡ä»»ä½•ä¸€ç§å‘é‡å­˜å‚¨å®ç°æ¥å®Œæˆ RAGï¼ˆRetrieval Augmented Generationï¼‰å·¥ä½œæµã€‚è¿™æ˜¯é€šè¿‡å°† `IVectorSearchable<TRecord>` åŒ…è£…ä¸ºä¸€ä¸ª**æ–‡æœ¬æœç´¢ï¼ˆText Searchï¼‰**å®ç°æ¥å®ç°çš„ã€‚

---

## å‘é‡å­˜å‚¨æŠ½è±¡å±‚ï¼ˆVector Store Abstractionï¼‰

å‘é‡å­˜å‚¨çš„æŠ½è±¡æ¥å£ç”± NuGet åŒ… [`Microsoft.Extensions.VectorData.Abstractions`](https://www.nuget.org/packages/Microsoft.Extensions.VectorData.Abstractions) æä¾›ã€‚è¯¥åŒ…å®šä¹‰äº†ä¸å‘é‡æ•°æ®åº“äº¤äº’çš„æ ¸å¿ƒåŸºç±»å’Œæ¥å£ï¼Œä¾¿äºå®ç°ç»Ÿä¸€çš„å­˜å‚¨ä¸æ£€ç´¢é€»è¾‘ã€‚

---

## ğŸ“¦ ä¸»è¦æŠ½è±¡ç±»ä¸æ¥å£

### `Microsoft.Extensions.VectorData.VectorStore`

- è¡¨ç¤ºæ•´ä¸ªå‘é‡å­˜å‚¨ç³»ç»Ÿçš„å…¥å£ï¼Œå¯¹åº”ä¸€ä¸ªæ•°æ®åº“å®ä¾‹ï¼ŒåŒ…å«è‹¥å¹²é›†åˆã€‚
- æä¾›è·¨é›†åˆï¼ˆCollectionï¼‰çš„æ“ä½œï¼Œä¾‹å¦‚ï¼š
  - `ListCollectionNames()`ï¼šåˆ—å‡ºæ‰€æœ‰é›†åˆåç§°
- ä¹Ÿå¯ä»¥ç”¨æ¥è·å–æŒ‡å®šé›†åˆçš„å®ä¾‹ï¼š
  - `VectorStoreCollection<TKey, TRecord>`

---

### `Microsoft.Extensions.VectorData.VectorStoreCollection<TKey, TRecord>`

`VectorStoreCollection<TKey, TRecord>` è¡¨ç¤ºä¸€ä¸ªå‘é‡é›†åˆï¼ˆCollectionï¼‰ã€‚è¿™ä¸ªæŠ½è±¡åŸºç±»æä¾›äº†ç”¨äºæ£€æŸ¥é›†åˆæ˜¯å¦å­˜åœ¨ã€åˆ›å»ºé›†åˆæˆ–åˆ é™¤é›†åˆçš„æ–¹æ³•ã€‚

æ­¤å¤–ï¼Œè¯¥åŸºç±»è¿˜æä¾›äº†æ’å…¥æˆ–æ›´æ–°ï¼ˆUpsertï¼‰ã€è·å–ï¼ˆGetï¼‰ä»¥åŠåˆ é™¤ï¼ˆDeleteï¼‰è®°å½•çš„æ–¹æ³•ã€‚

æœ€åï¼Œè¯¥æŠ½è±¡åŸºç±»ç»§æ‰¿è‡ª `IVectorSearchable<TRecord>` æ¥å£ï¼Œä»è€Œå…·å¤‡äº†å‘é‡æœç´¢åŠŸèƒ½ã€‚

---

### `Microsoft.Extensions.VectorData.IVectorSearchable<TRecord>`

æ­¤æ¥å£å®šä¹‰äº†åŸºäºå‘é‡çš„æœç´¢æ“ä½œï¼Œæ ¸å¿ƒæ–¹æ³•ï¼š

```csharp
Task<IList<TRecord>> SearchAsync(...);
```

---

## Postgres Vectorå‘é‡å­˜å‚¨

ä»‹ç»å¦‚ä½•åœ¨ .NET ä¸­ä½¿ç”¨ Semantic Kernel æä¾›çš„å‘é‡å­˜å‚¨æŠ½è±¡æ¥æ„å»ºæ£€ç´¢å¢å¼ºç”Ÿæˆï¼ˆRAGï¼‰å·¥ä½œæµã€‚

---

### ğŸ“¦ å®‰è£…å¿…è¦çš„ NuGet åŒ…

æ‰€æœ‰ä¸å‘é‡å­˜å‚¨ç›¸å…³çš„æŠ½è±¡æ¥å£éƒ½åŒ…å«åœ¨ä»¥ä¸‹åŒ…ä¸­ï¼š

```bash
dotnet add package Microsoft.SemanticKernel.Connectors.PgVector --prerelease
```

æ¯ç§å‘é‡æ•°æ®åº“çš„å…·ä½“å®ç°éƒ½ä½äºå…¶å„è‡ªç‹¬ç«‹çš„ NuGet åŒ…ä¸­ã€‚

Semantic Kernel æ”¯æŒçš„å‘é‡æ•°æ®åº“è¿æ¥å™¨ä¸€è§ˆï¼ˆVector Store Connectorsï¼‰

| å‘é‡æ•°æ®åº“è¿æ¥å™¨              | æ”¯æŒ C# | ä½¿ç”¨å®˜æ–¹ SDK | ç»´æŠ¤è€… / æä¾›æ–¹                        |
|------------------------------|---------|---------------|----------------------------------------|
| Azure AI Search              | âœ…      | âœ…            | Microsoft Semantic Kernel Project      |
| Cosmos DB MongoDBï¼ˆvCoreï¼‰   | âœ…      | âœ…            | Microsoft Semantic Kernel Project      |
| Cosmos DB NoSQL              | âœ…      | âœ…            | Microsoft Semantic Kernel Project      |
| Couchbase                    | âœ…      | âœ…            | Couchbase                              |
| Elasticsearch                | âœ…      | âœ…            | Elastic                                |
| Chroma                       | ğŸš§ è®¡åˆ’ä¸­ | -             | -                                      |
| In-Memory                    | âœ…      | N/A           | Microsoft Semantic Kernel Project      |
| Milvus                       | ğŸš§ è®¡åˆ’ä¸­ | -             | -                                      |
| MongoDB                     | âœ…      | âœ…            | Microsoft Semantic Kernel Project      |
| Neon Serverless Postgres     | âœ…ï¼ˆé€šè¿‡ Postgresï¼‰ | âœ… | Microsoft Semantic Kernel Project      |
| Pinecone                     | âœ…      | âŒ            | Microsoft Semantic Kernel Project      |
| Postgres                     | âœ…      | âœ…            | Microsoft Semantic Kernel Project      |
| Qdrant                       | âœ…      | âœ…            | Microsoft Semantic Kernel Project      |
| Redis                        | âœ…      | âœ…            | Microsoft Semantic Kernel Project      |
| SQL Server                   | âœ…      | âœ…            | Microsoft Semantic Kernel Project      |
| SQLite                       | âœ…      | âœ…            | Microsoft Semantic Kernel Project      |
| Volatileï¼ˆå†…å­˜æ¨¡å¼ï¼Œå·²åºŸå¼ƒï¼‰ | âŒ å·²åºŸå¼ƒ | N/A           | Microsoft Semantic Kernel Project      |
| Weaviate                     | âœ…      | âœ…            | Microsoft Semantic Kernel Project      |

---

âœ… è¡¨ç¤ºæ”¯æŒï¼ŒâŒ è¡¨ç¤ºä¸æ”¯æŒï¼ŒğŸš§ è¡¨ç¤ºå¼€å‘ä¸­ï¼ŒN/A è¡¨ç¤ºä¸é€‚ç”¨ã€‚

> â„¹ï¸ **è¯´æ˜ï¼š**
> - å¤§å¤šæ•°è¿æ¥å™¨ç”± Microsoft Semantic Kernel å®˜æ–¹ç»´æŠ¤ã€‚
> - Pinecone å°½ç®¡æ”¯æŒ C#ï¼Œä½†å½“å‰å¹¶æœªä½¿ç”¨å®˜æ–¹ SDKã€‚
> - Volatile æ¨¡å¼å·²åºŸå¼ƒï¼Œè¯·æ”¹ç”¨æ–°çš„ In-Memory å®ç°ã€‚

## ä½¿ç”¨Postgres Vector Store connector

### å®‰è£… NuGet åŒ…

```bash
dotnet add package Microsoft.SemanticKernel.Connectors.PgVector --prerelease
```

### åœ¨ ASP.NET Core ä¸­é€šè¿‡ä¾èµ–æ³¨å…¥æ³¨å†Œ

```csharp
builder.Services.AddPostgresVectorStore(
    builder.Configuration.GetConnectionString("Postgres")!
);

//ä½¿ç”¨AzureOpenAIæƒ³é‡åŒ–æ•°æ®
builder.Services.Configure<AzureEmbeddingOptions>(
    builder.Configuration.GetSection("Embedding"));

builder.Services.AddSingleton(sp =>
{
    var endpoint = builder.Configuration["Embedding:Endpoint"]
        ?? throw new InvalidOperationException("Missing AzureOpenAI:Endpoint");
    var key = builder.Configuration["Embedding:ApiKey"]
        ?? throw new InvalidOperationException("Missing AzureOpenAI:ApiKey");
    return new AzureOpenAIClient(new Uri(endpoint), new AzureKeyCredential(key));
});
```

### æ•°æ®æ˜ å°„æ¨¡å‹
é»˜è®¤æ˜ å°„è§„åˆ™ï¼šç±»å±æ€§å â†” æ•°æ®åº“åˆ—å
å¯é€šè¿‡ StorageName ç‰¹æ€§è¦†ç›–å±æ€§å
```csharp
using Microsoft.Extensions.VectorData;

  public class Hotel
  {
      [VectorStoreKey(StorageName = "hotel_id")]
      public int HotelId { get; set; }

      [VectorStoreData(StorageName = "hotel_name")]
      public string? HotelName { get; set; }

      [VectorStoreData(StorageName = "hotel_description")]
      public string? Description { get; set; }

      [VectorStoreVector(Dimensions: EmbeddingDims.Description, DistanceFunction = DistanceFunction.CosineSimilarity, StorageName = "description_embedding")]
      public ReadOnlyMemory<float>? DescriptionEmbedding { get; set; }
  }
```

### VectorStoreVectorAttribute å‚æ•°è¯´æ˜

| å‚æ•°            | å¿…é¡» | æè¿°                                                         |
|-----------------|------|--------------------------------------------------------------|
| `Dimensions`    | âœ…   | å‘é‡çš„ç»´åº¦æ•°ã€‚ä¸ºé›†åˆåˆ›å»ºå‘é‡ç´¢å¼•æ—¶å¿…é¡»æŒ‡å®šã€‚                  |
| `IndexKind`     | âŒ   | å‘é‡ç´¢å¼•çš„ç±»å‹ã€‚é»˜è®¤å€¼ç”±å…·ä½“çš„ Vector Store ç±»å‹å†³å®šã€‚        |
| `DistanceFunction` | âŒ | å‘é‡æ£€ç´¢æ—¶ä½¿ç”¨çš„ç›¸ä¼¼åº¦åº¦é‡å‡½æ•°ã€‚é»˜è®¤å€¼ç”±å…·ä½“çš„ Vector Store ç±»å‹å†³å®šã€‚ |
| `StorageName`   | âŒ   | ä¸ºæ•°æ®åº“ä¸­åˆ—æä¾›æ›¿ä»£åç§°ï¼ˆå¹¶éæ‰€æœ‰è¿æ¥å™¨éƒ½æ”¯æŒï¼‰ã€‚            |

---

### åˆ›å»ºè¡¨

è¿™ä¸€æ­¥éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨åœ¨Postgresä¸­åˆ›å»ºå­˜å‚¨æ•°æ®çš„è¡¨ï¼Œé¦–å…ˆè¦å®‰è£…pgvectoræ’ä»¶ï¼Œå…·ä½“å®‰è£…æ–¹æ³•è¯·çœ‹ä¸Šä¸€èŠ‚å†…å®¹

```csharp
CREATE TABLE public.hotels (
    hotel_id INTEGER NOT NULL,
    hotel_name TEXT,
    hotel_description TEXT,
    description_embedding VECTOR(1536),
    PRIMARY KEY ("hotel_id")
);
```

### æ¼”ç¤ºæ•ˆæœ

åˆ›å»ºé…’åº—
![é…’åº—å‘é‡å­˜å‚¨ç¤ºæ„å›¾](/docs/æ™ºèƒ½ä½“å¼€å‘æ¡†æ¶/SemanticKernel/Materials/create-query.png)

é…’åº—å‘é‡æŸ¥è¯¢

![é…’åº—å‘é‡å­˜å‚¨ç¤ºæ„å›¾](/docs/æ™ºèƒ½ä½“å¼€å‘æ¡†æ¶/SemanticKernel/Materials/hotel-query.png)

---

## ğŸ“‚ ç¤ºä¾‹é¡¹ç›®æºç 

æŸ¥çœ‹å®Œæ•´çš„ç¤ºä¾‹é¡¹ç›®ä¸ä»£ç å®ç°ï¼š

[https://github.com/bingbing-gui/aspnetcore-developer/tree/master/src/09-AI-Agent/SemanticKernel/SK.VectorStores](https://github.com/bingbing-gui/aspnetcore-developer/tree/master/src/09-AI-Agent/SemanticKernel/SK.VectorStores)

## âœ… æ€»ç»“

é€šè¿‡ .NET + Semantic Kernel + å‘é‡å­˜å‚¨ çš„ç»„åˆï¼Œä½ å¯ä»¥å¿«é€Ÿå®ç°ä¸€ä¸ªå®Œæ•´çš„ RAG ç³»ç»Ÿï¼Œæ”¯æŒï¼š

- ä½¿ç”¨æ¨¡å‹æ³¨è§£æ–¹å¼å®šä¹‰æ•°æ®ç»“æ„
- é«˜æ•ˆè¿›è¡Œå‘é‡æ’å…¥ã€æ£€ç´¢ã€åˆ é™¤
- ä¸ AI æ¨¡å‹è‡ªç„¶é›†æˆï¼ˆå¦‚ OpenAIã€Azure OpenAIï¼‰
